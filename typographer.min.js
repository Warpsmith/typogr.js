/*!
  * typographer.js
  * Copyright(c) 2011 Eugene Kalinin
  * MIT Licensed
  */(function(a){var b=function(a){return new n(a)};b.version="0.4.0",typeof module!="undefined"&&module.exports?module.exports=b:a.typographer=b;var c=b.amp=function(a){var b=/(\s|&nbsp;)(&|&amp;|&\#38;)(\s|&nbsp;)/g,c=/(<[^<]*>)?([^<]*)(<\/[^<]*>)?/g;if(!!a)return a.replace(c,function(a,c,d,e){var c=c||"",e=e||"",d=d.replace(b,'$1<span class="amp">&amp;</span>$3');return c+d+e})},d=b.ord=function(a){var b=/(\d+)(st|nd|rd|th)/g;if(!!a)return a.replace(b,'$1<span class="ord">$2</span>')},e=b.quotes=function(a){var b=new RegExp("(?:(?:<(?:p|h[1-6]|li|dt|dd)[^>]*>|^)\\s*(?:<(?:a|em|span|strong|i|b)[^>]*>s*)*)(?:(\"|&ldquo;|&#8220;)|('|&lsquo;|&#8216;))","i");if(!!a)return a.replace(b,function(a,b,c){var d=b?"dquo":"quo",e=b?b:c;return[a.slice(0,a.lastIndexOf(e)),'<span class="',d,'">',e,"</span>"].join("")})},f=b.widont=function(a){var b=new RegExp("((?:</?(?:a|em|span|strong|i|b)[^>]*>)|[^<>\\s])\\s+([^<>\\s]+\\s*(</(a|em|span|strong|i|b)>\\s*)*((</(p|h[1-6]|li|dt|dd)>)|$))","gi");return a.replace(b,"$1&nbsp;$2")};b.typogrify=function(a){a=c(a),a=f(a),a=g(a),a=e(a),a=d(a);return a};var g=b.smartypants=function(a){var b=h(a),c=[],d=/<(\/)?(pre|code|kbd|script|math)[^>]*>/i,e=[],f="",g="",n=!1,o="",p,q;b.forEach(function(a){if(a.type==="tag")c.push(a.txt),(g=d.exec(a.txt))!=null&&(f=g[2].toLowerCase(),g[1]?(e.length>0&&f===e[-1]&&e.pop(),e.length===0&&(n=!1)):(e.push(f),n=!0));else{q=a.txt,p=q.slice(-1);if(!n){q=i(q),q=j(q),q=k(q),q=l(q);switch(q){case"'":/\S/.test(o)?q="&#8217;":q="&#8216;";break;case'"':/\S/.test(o)?q="&#8221;":q="&#8220;";break;default:q=m(q)}}o=p,c.push(q)}});return c.join("")},h=b.tokenize=function(a){var b=[],c=0,d=/([^<]*)(<[^>]*>)/gi,e;while((e=d.exec(a))!=null){var f=e[1],g=e[2];f&&b.push({type:"text",txt:f}),b.push({type:"tag",txt:g}),c=d.lastIndex}d.lastIndex<=a.length&&b.push({type:"text",txt:a.slice(c)});return b},i=b.smartEscapes=function(a){return a.replace(/\\"/g,"&#34;").replace(/\\'/g,"&#39;").replace(/\\-/g,"&#45;").replace(/\\\./g,"&#46;").replace(/\\\\/g,"&#92;").replace(/\\`/g,"&#96;")},j=b.smartDashes=function(a){return a.replace(/---/g,"&#8211;").replace(/--/g,"&#8212;")},k=b.smartEllipses=function(a){return a.replace(/\.\.\./g,"&#8230;").replace(/\. \. \./g,"&#8230;")},l=b.smartBackticks=function(a){return a.replace(/``/g,"&#8220;").replace(/''/g,"&#8221;")},m=b.smartQuotes=function(a){var b="[!\"#$%'()*+,-./:;<=>?@[\\]^_`{|}~]",c="(?=%s\\B)".replace("%s",b),d="[^ \t\r\n[{(-]",e="&#8211;|&#8212;",f=new RegExp("(s           |&nbsp;       |--           |&[mn]dash;   |"+e+"|"+"&#x201[34];"+")"+"'"+"(?=w)","g"),g=new RegExp("("+d+")"+"'"+"(?!s | s\b | d)","g"),h=new RegExp("("+d+")"+"'"+"(?!s | s\b)","g"),i=new RegExp("(s           |&nbsp;       |--           |&[mn]dash;   |"+e+"|"+"&#x201[34];"+")"+'"'+"(?=w)","g"),j=new RegExp('"(?=s)',"g"),k=new RegExp("("+d+')"',"g");return a.replace(new RegExp("^'%s".replace("%s",c),"g"),"&#8217;").replace(new RegExp('^"%s'.replace("%s",c),"g"),"&#8221;").replace(/"'(?=\w)/g,"&#8220;&#8216;").replace(/'"(?=\w)/g,"&#8216;&#8220;").replace(/\b'(?=\d{2}s)/g,"&#8217;").replace(f,"$1&#8216;").replace(g,"$1&#8217;").replace(h,"$1&#8217;$2").replace("'","&#8216;").replace(i,"$1&#8220;").replace(j,"&#8221;").replace(k,"$1&#8221;").replace('"',"&#8220;")},n=function(a){this._wrapped=a},o=function(a,c){return c?b(a).chain():a},p=function(a,c){n.prototype[a]=function(){return o(c.apply(b,[this._wrapped]),this._chain)}},q=function(a){return!!(a&&a.constructor&&a.call&&a.apply)};for(var r in b)q(b[r])&&p(r,b[r]);n.prototype.chain=function(){this._chain=!0;return this},n.prototype.value=function(){return this._wrapped}})(this)